<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Analysis Results - Healthcare AI Assistant</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/animejs/3.2.1/anime.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/echarts/5.4.3/echarts.min.js"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
    <style>
        * { font-family: 'Inter', sans-serif; }
        .gradient-bg { background: linear-gradient(135deg, #f8fafc 0%, #e2e8f0 100%); }
        .medical-gradient { background: linear-gradient(135deg, #2563eb 0%, #059669 100%); }
        .hover-lift { transition: all 0.3s ease; }
        .hover-lift:hover { transform: translateY(-2px); box-shadow: 0 10px 25px -5px rgba(0, 0, 0, 0.1); }
        .confidence-bar { transition: width 1s ease-out; }
        .severity-critical { background: linear-gradient(135deg, #dc2626 0%, #ef4444 100%); }
        .severity-severe { background: linear-gradient(135deg, #ea580c 0%, #f97316 100%); }
        .severity-moderate { background: linear-gradient(135deg, #ca8a04 0%, #eab308 100%); }
        .severity-mild { background: linear-gradient(135deg, #059669 0%, #10b981 100%); }
        .prediction-card { transition: all 0.3s ease; }
        .prediction-card:hover { transform: translateY(-4px); }
        .expandable-content { max-height: 0; overflow: hidden; transition: max-height 0.3s ease; }
        .expandable-content.expanded { max-height: 500px; }
    </style>
</head>
<body class="gradient-bg min-h-screen">
    <!-- Navigation -->
    <nav class="bg-white/90 backdrop-blur-sm border-b border-gray-200 sticky top-0 z-50">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex justify-between items-center h-16">
                <div class="flex items-center space-x-3">
                    <div class="w-10 h-10 medical-gradient rounded-lg flex items-center justify-center">
                        <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4.318 6.318a4.5 4.5 0 000 6.364L12 20.364l7.682-7.682a4.5 4.5 0 00-6.364-6.364L12 7.636l-1.318-1.318a4.5 4.5 0 00-6.364 0z"></path>
                        </svg>
                    </div>
                    <div>
                        <h1 class="text-xl font-bold text-gray-900">Healthcare AI</h1>
                        <p class="text-xs text-gray-500">Analysis Results</p>
                    </div>
                </div>
                <div class="flex items-center space-x-4">
                    <a href="index.html" class="text-gray-600 hover:text-blue-600 transition-colors">
                        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 19l-7-7m0 0l7-7m-7 7h18"></path>
                        </svg>
                    </a>
                    <a href="profile.html" class="text-gray-600 hover:text-blue-600 transition-colors">
                        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"></path>
                        </svg>
                    </a>
                </div>
            </div>
        </div>
    </nav>

    <!-- Main Content -->
    <main class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
        <!-- Header -->
        <div class="text-center mb-8">
            <h2 class="text-3xl font-bold text-gray-900 mb-4">Analysis Results</h2>
            <p class="text-lg text-gray-600">Based on your symptoms, here are the most likely conditions</p>
        </div>

        <div class="grid lg:grid-cols-3 gap-8">
            <!-- Main Results -->
            <div class="lg:col-span-2 space-y-6">
                <!-- Severity Assessment -->
                <div id="severityCard" class="bg-white rounded-2xl shadow-lg p-6">
                    <div class="flex items-center justify-between mb-4">
                        <h3 class="text-xl font-semibold text-gray-900">Severity Assessment</h3>
                        <div id="severityBadge" class="px-4 py-2 rounded-full text-white font-semibold">
                            Calculating...
                        </div>
                    </div>
                    <div class="mb-4">
                        <div class="flex justify-between text-sm text-gray-600 mb-2">
                            <span>Symptom Severity Score</span>
                            <span id="severityScore">0</span>
                        </div>
                        <div class="w-full bg-gray-200 rounded-full h-3">
                            <div id="severityBar" class="h-3 rounded-full transition-all duration-1000" style="width: 0%"></div>
                        </div>
                    </div>
                    <div id="severityDescription" class="text-sm text-gray-700">
                        Analyzing your symptoms...
                    </div>
                </div>

                <!-- Top Predictions -->
                <div class="bg-white rounded-2xl shadow-lg p-6">
                    <h3 class="text-xl font-semibold text-gray-900 mb-6">Top Disease Predictions</h3>
                    <div id="predictionsList" class="space-y-4">
                        <!-- Predictions will be loaded here -->
                    </div>
                </div>

                <!-- Symptoms Analysis -->
                <div class="bg-white rounded-2xl shadow-lg p-6">
                    <h3 class="text-xl font-semibold text-gray-900 mb-6">Symptom Analysis</h3>
                    <div class="grid md:grid-cols-2 gap-6">
                        <div>
                            <h4 class="font-medium text-gray-900 mb-3">Your Symptoms</h4>
                            <div id="userSymptomsList" class="space-y-2">
                                <!-- User symptoms will be loaded here -->
                            </div>
                        </div>
                        <div>
                            <h4 class="font-medium text-gray-900 mb-3">Severity Distribution</h4>
                            <div id="severityChart" style="height: 200px;"></div>
                        </div>
                    </div>
                </div>

                <!-- AI Insights -->
                <div class="bg-gradient-to-br from-blue-50 to-green-50 rounded-2xl p-6">
                    <div class="flex items-center mb-4">
                        <div class="w-12 h-12 medical-gradient rounded-full flex items-center justify-center mr-4">
                            <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9.75 17L9 20l-1 1h8l-1-1-.75-3M3 13h18M5 17h14a2 2 0 002-2V5a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z"></path>
                            </svg>
                        </div>
                        <div>
                            <h3 class="text-xl font-semibold text-gray-900">AI Health Insights</h3>
                            <p class="text-sm text-gray-600">Personalized analysis from our medical AI</p>
                        </div>
                    </div>
                    <div id="aiInsights" class="text-gray-700">
                        <!-- AI insights will be loaded here -->
                    </div>
                </div>
            </div>

            <!-- Sidebar -->
            <div class="space-y-6">
                <!-- Quick Actions -->
                <div class="bg-white rounded-2xl shadow-lg p-6">
                    <h4 class="text-lg font-semibold text-gray-900 mb-4">Quick Actions</h4>
                    <div class="space-y-3">
                        <button id="getRecommendationsBtn" class="w-full bg-gradient-to-r from-blue-600 to-green-600 text-white py-3 px-4 rounded-lg font-semibold hover:from-blue-700 hover:to-green-700 transition-all">
                            Get Personalized Recommendations
                        </button>
                        <button id="saveResultsBtn" class="w-full bg-gray-100 text-gray-700 py-3 px-4 rounded-lg font-semibold hover:bg-gray-200 transition-colors">
                            Save Results
                        </button>
                        <button id="shareResultsBtn" class="w-full bg-gray-100 text-gray-700 py-3 px-4 rounded-lg font-semibold hover:bg-gray-200 transition-colors">
                            Share with Doctor
                        </button>
                    </div>
                </div>

                <!-- Health Tips -->
                <div class="bg-white rounded-2xl shadow-lg p-6">
                    <h4 class="text-lg font-semibold text-gray-900 mb-4">Health Tips</h4>
                    <div id="healthTips" class="space-y-3">
                        <!-- Health tips will be loaded here -->
                    </div>
                </div>

                <!-- Emergency Contacts -->
                <div class="bg-red-50 border border-red-200 rounded-2xl p-6">
                    <h4 class="text-lg font-semibold text-red-900 mb-4">⚠️ Emergency Information</h4>
                    <div class="space-y-2 text-sm text-red-800">
                        <p>• This analysis is for educational purposes only</p>
                        <p>• Always consult a healthcare professional</p>
                        <p>• Call emergency services for severe symptoms</p>
                        <p>• Don't self-medicate based on these results</p>
                    </div>
                </div>

                <!-- AI Assistant -->
                <div class="bg-gradient-to-br from-purple-50 to-blue-50 rounded-2xl p-6">
                    <div class="flex items-center mb-4">
                        <div class="w-10 h-10 bg-gradient-to-r from-purple-600 to-blue-600 rounded-full flex items-center justify-center mr-3">
                            <svg class="w-5 h-5 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z"></path>
                            </svg>
                        </div>
                        <div>
                            <h4 class="font-semibold text-gray-900">AI Assistant</h4>
                            <p class="text-xs text-gray-600">Ask health questions</p>
                        </div>
                    </div>
                    <div class="space-y-3">
                        <button class="ai-question w-full text-left p-3 bg-white rounded-lg hover:bg-gray-50 transition-colors text-sm" data-question="What should I do next?">
                            What should I do next?
                        </button>
                        <button class="ai-question w-full text-left p-3 bg-white rounded-lg hover:bg-gray-50 transition-colors text-sm" data-question="When should I see a doctor?">
                            When should I see a doctor?
                        </button>
                        <button class="ai-question w-full text-left p-3 bg-white rounded-lg hover:bg-gray-50 transition-colors text-sm" data-question="Are these symptoms serious?">
                            Are these symptoms serious?
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <!-- Footer -->
    <footer class="bg-white border-t border-gray-200 py-8 mt-16">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="text-center">
                <p class="text-sm text-gray-600">
                    © 2025 Healthcare AI Assistant. This tool is for educational purposes and should not replace professional medical advice.
                </p>
            </div>
        </div>
    </footer>

    <script src="main.js"></script>
    <script>
        class ResultsPage {
            constructor() {
                this.analysisData = null;
                this.initializePage();
            }

            initializePage() {
                this.loadAnalysisData();
                this.displayResults();
                this.initializeCharts();
                this.setupEventListeners();
                this.generateAIInsights();
                this.loadHealthTips();
            }

            loadAnalysisData() {
                const data = sessionStorage.getItem('symptomAnalysis');
                if (data) {
                    this.analysisData = JSON.parse(data);
                } else {
                    // Mock data for demonstration
                    this.analysisData = {
                        symptoms: ['headache', 'fever', 'cough'],
                        severityScore: 15,
                        severityLevel: { level: 'Moderate', color: 'yellow', icon: '🟡' },
                        predictions: [
                            { disease: 'Common Cold', confidence: 85, matchingSymptoms: ['cough', 'fever'] },
                            { disease: 'Flu', confidence: 72, matchingSymptoms: ['fever', 'headache'] },
                            { disease: 'Bronchial Asthma', confidence: 45, matchingSymptoms: ['cough'] }
                        ],
                        timestamp: new Date().toISOString()
                    };
                }
            }

            displayResults() {
                this.displaySeverityAssessment();
                this.displayPredictions();
                this.displaySymptoms();
            }

            displaySeverityAssessment() {
                const { severityScore, severityLevel } = this.analysisData;
                const percentage = Math.min((severityScore / 50) * 100, 100);

                document.getElementById('severityScore').textContent = severityScore;
                document.getElementById('severityBadge').textContent = severityLevel.level;
                document.getElementById('severityBadge').className = `px-4 py-2 rounded-full text-white font-semibold severity-${severityLevel.level.toLowerCase()}`;
                
                const severityBar = document.getElementById('severityBar');
                severityBar.style.width = `${percentage}%`;
                severityBar.className = `h-3 rounded-full transition-all duration-1000 severity-${severityLevel.level.toLowerCase()}`;

                const descriptions = {
                    'Mild': 'Your symptoms appear to be mild. Monitor your condition and consider rest and home remedies.',
                    'Moderate': 'Your symptoms are moderate. Consider consulting a healthcare provider if symptoms persist or worsen.',
                    'Severe': 'Your symptoms are severe. We recommend consulting a healthcare provider soon.',
                    'Critical': 'Your symptoms are critical. Seek immediate medical attention.'
                };

                document.getElementById('severityDescription').textContent = descriptions[severityLevel.level];
            }

            displayPredictions() {
                const predictionsList = document.getElementById('predictionsList');
                const predictions = this.analysisData.predictions;

                predictionsList.innerHTML = predictions.map((prediction, index) => `
                    <div class="prediction-card bg-gray-50 rounded-xl p-6 hover-lift" data-index="${index}">
                        <div class="flex items-center justify-between mb-4">
                            <div class="flex items-center">
                                <div class="w-12 h-12 bg-gradient-to-r from-blue-500 to-green-500 rounded-lg flex items-center justify-center mr-4">
                                    <span class="text-white font-bold text-lg">${index + 1}</span>
                                </div>
                                <div>
                                    <h4 class="text-lg font-semibold text-gray-900">${prediction.disease}</h4>
                                    <p class="text-sm text-gray-600">${prediction.matchingSymptoms.length} matching symptoms</p>
                                </div>
                            </div>
                            <div class="text-right">
                                <div class="text-2xl font-bold text-blue-600">${prediction.confidence}%</div>
                                <div class="text-sm text-gray-500">Confidence</div>
                            </div>
                        </div>
                        
                        <div class="mb-4">
                            <div class="flex justify-between text-sm text-gray-600 mb-2">
                                <span>Confidence Level</span>
                                <span>${prediction.confidence}%</span>
                            </div>
                            <div class="w-full bg-gray-200 rounded-full h-2">
                                <div class="confidence-bar bg-gradient-to-r from-blue-500 to-green-500 h-2 rounded-full" 
                                     style="width: 0%" data-width="${prediction.confidence}%"></div>
                            </div>
                        </div>

                        <div class="mb-4">
                            <button class="expand-btn text-blue-600 hover:text-blue-800 text-sm font-medium transition-colors" 
                                    onclick="resultsPage.togglePredictionDetails(${index})">
                                View Details →
                            </button>
                        </div>

                        <div id="prediction-details-${index}" class="expandable-content">
                            <div class="border-t pt-4 mt-4">
                                <h5 class="font-medium text-gray-900 mb-2">Matching Symptoms:</h5>
                                <div class="flex flex-wrap gap-2 mb-4">
                                    ${prediction.matchingSymptoms.map(symptom => `
                                        <span class="px-3 py-1 bg-blue-100 text-blue-800 rounded-full text-sm">
                                            ${this.formatSymptomName(symptom)}
                                        </span>
                                    `).join('')}
                                </div>
                                <p class="text-sm text-gray-700">${this.getDiseaseDescription(prediction.disease)}</p>
                            </div>
                        </div>
                    </div>
                `).join('');

                // Animate confidence bars
                setTimeout(() => {
                    document.querySelectorAll('.confidence-bar').forEach(bar => {
                        const width = bar.dataset.width;
                        bar.style.width = width;
                    });
                }, 500);
            }

            displaySymptoms() {
                const userSymptomsList = document.getElementById('userSymptomsList');
                const symptoms = this.analysisData.symptoms;

                userSymptomsList.innerHTML = symptoms.map(symptom => {
                    const severity = this.getSymptomSeverity(symptom);
                    const severityColor = this.getSeverityColor(severity);
                    
                    return `
                        <div class="flex items-center justify-between p-3 bg-gray-50 rounded-lg">
                            <span class="font-medium">${this.formatSymptomName(symptom)}</span>
                            <span class="px-2 py-1 ${severityColor} text-white rounded-full text-xs">
                                ${severity}/7
                            </span>
                        </div>
                    `;
                }).join('');
            }

            initializeCharts() {
                this.createSeverityChart();
            }

            createSeverityChart() {
                const chartDom = document.getElementById('severityChart');
                const myChart = echarts.init(chartDom);

                const symptoms = this.analysisData.symptoms;
                const severityData = symptoms.map(symptom => ({
                    name: this.formatSymptomName(symptom),
                    value: this.getSymptomSeverity(symptom)
                }));

                const option = {
                    tooltip: {
                        trigger: 'item',
                        formatter: '{b}: {c}/7'
                    },
                    series: [{
                        type: 'pie',
                        radius: ['40%', '70%'],
                        data: severityData,
                        emphasis: {
                            itemStyle: {
                                shadowBlur: 10,
                                shadowOffsetX: 0,
                                shadowColor: 'rgba(0, 0, 0, 0.5)'
                            }
                        },
                        itemStyle: {
                            borderRadius: 5,
                            borderColor: '#fff',
                            borderWidth: 2
                        },
                        label: {
                            show: false
                        }
                    }]
                };

                myChart.setOption(option);
            }

            setupEventListeners() {
                document.getElementById('getRecommendationsBtn').addEventListener('click', () => {
                    window.location.href = 'recommendations.html';
                });

                document.getElementById('saveResultsBtn').addEventListener('click', () => {
                    this.saveResults();
                });

                document.getElementById('shareResultsBtn').addEventListener('click', () => {
                    this.shareResults();
                });

                document.querySelectorAll('.ai-question').forEach(button => {
                    button.addEventListener('click', (e) => {
                        const question = e.target.dataset.question;
                        this.askAI(question);
                    });
                });
            }

            togglePredictionDetails(index) {
                const details = document.getElementById(`prediction-details-${index}`);
                const button = document.querySelector(`[data-index="${index}"] .expand-btn`);
                
                if (details.classList.contains('expanded')) {
                    details.classList.remove('expanded');
                    button.textContent = 'View Details →';
                } else {
                    details.classList.add('expanded');
                    button.textContent = 'Hide Details ←';
                }
            }

            async generateAIInsights() {
                const aiInsights = document.getElementById('aiInsights');
                const { symptoms, predictions, severityLevel } = this.analysisData;

                // Show loading state
                aiInsights.innerHTML = `
                    <div class="flex items-center justify-center py-6">
                        <div class="animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600 mr-3"></div>
                        <span class="text-gray-700">AI is generating personalized insights...</span>
                    </div>
                `;

                try {
                    // Prepare context for AI
                    const context = {
                        symptoms: symptoms.join(', '),
                        severityLevel: severityLevel.level,
                        predictions: predictions.map(p => `${p.disease} (${p.confidence}%)`).join(', '),
                        age: healthcareAI.userProfile.age || 'Unknown',
                        gender: healthcareAI.userProfile.gender || 'Unknown'
                    };

                    // Create prompt for comprehensive health insights
                    const prompt = `Based on the following health information, provide a comprehensive and personalized health insight:
                    
Symptoms: ${symptoms.join(', ')}
Severity Level: ${severityLevel.level}
Top Predictions: ${predictions.slice(0, 3).map(p => `${p.disease} (${p.confidence}% confidence)`).join(', ')}

Please provide:
1. A brief analysis of what these symptoms indicate
2. Recommendations for immediate care and monitoring
3. Important points to remember

Keep the response professional, empathetic, and easy to understand.`;

                    // Call Gemini AI
                    const aiResponse = await healthcareAI.callGeminiAI(prompt, context);

                    // Display AI-generated insights
                    aiInsights.innerHTML = `
                        <div class="space-y-4">
                            <div class="flex items-center mb-4">
                                <div class="w-10 h-10 bg-gradient-to-r from-purple-600 to-blue-600 rounded-full flex items-center justify-center mr-3">
                                    <svg class="w-5 h-5 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9.75 17L9 20l-1 1h8l-1-1-.75-3M3 13h18M5 17h14a2 2 0 002-2V5a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z"></path>
                                    </svg>
                                </div>
                                <p class="font-medium text-gray-900">AI-Generated Health Insights</p>
                            </div>
                            <div class="bg-white rounded-lg p-4 shadow-sm">
                                <div class="text-gray-700 whitespace-pre-wrap">${aiResponse}</div>
                            </div>
                            <div class="flex items-center text-sm text-gray-600 bg-yellow-50 p-3 rounded-lg">
                                <svg class="w-4 h-4 mr-2 flex-shrink-0" fill="currentColor" viewBox="0 0 20 20">
                                    <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z" clip-rule="evenodd"></path>
                                </svg>
                                <span>This AI analysis is powered by Google Gemini and is for educational purposes only. Always consult healthcare professionals.</span>
                            </div>
                        </div>
                    `;
                } catch (error) {
                    console.error('AI Insights Error:', error);
                    // Fallback to template-based insights
                    const insights = this.generatePersonalizedInsights(symptoms, predictions, severityLevel);
                    aiInsights.innerHTML = `
                        <div class="space-y-4">
                            <p class="font-medium text-gray-900">Based on your symptoms analysis:</p>
                            <div class="bg-white rounded-lg p-4">
                                <p class="text-gray-700">${insights.primary}</p>
                            </div>
                            <div class="bg-white rounded-lg p-4">
                                <p class="text-gray-700">${insights.secondary}</p>
                            </div>
                            <div class="flex items-center text-sm text-gray-600">
                                <svg class="w-4 h-4 mr-2" fill="currentColor" viewBox="0 0 20 20">
                                    <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z" clip-rule="evenodd"></path>
                                </svg>
                                This analysis is based on patterns from thousands of medical cases.
                            </div>
                        </div>
                    `;
                }
            }

            generatePersonalizedInsights(symptoms, predictions, severityLevel) {
                const topPrediction = predictions[0];
                const insightTemplates = {
                    primary: [
                        `Your symptoms of ${symptoms.slice(0, 2).join(' and ')} suggest ${topPrediction.disease.toLowerCase()} with ${topPrediction.confidence}% confidence.`,
                        `Based on the pattern of ${symptoms.length} symptoms, ${topPrediction.disease.toLowerCase()} is the most likely diagnosis.`,
                        `The combination of ${symptoms.join(', ')} indicates a high probability of ${topPrediction.disease.toLowerCase()}.`
                    ],
                    secondary: [
                        `Given the ${severityLevel.level.toLowerCase()} severity level, consider ${severityLevel.level === 'Critical' ? 'immediate medical attention' : 'consulting with a healthcare provider'}.`,
                        `With a severity score of ${this.analysisData.severityScore}, ${severityLevel.level === 'Mild' ? 'home care and monitoring' : 'professional medical evaluation'} is recommended.`,
                        `The ${severityLevel.level.toLowerCase()} classification suggests ${severityLevel.level === 'Severe' || severityLevel.level === 'Critical' ? 'urgent medical care' : 'monitoring your symptoms'}.`
                    ]
                };

                return {
                    primary: insightTemplates.primary[Math.floor(Math.random() * insightTemplates.primary.length)],
                    secondary: insightTemplates.secondary[Math.floor(Math.random() * insightTemplates.secondary.length)]
                };
            }

            loadHealthTips() {
                const healthTips = document.getElementById('healthTips');
                const tips = [
                    'Stay hydrated by drinking plenty of water',
                    'Get adequate rest and sleep',
                    'Monitor your symptoms daily',
                    'Avoid self-medication without consulting a doctor',
                    'Keep a symptom diary for your doctor',
                    'Maintain good hygiene practices',
                    'Eat a balanced, nutritious diet'
                ];

                healthTips.innerHTML = tips.slice(0, 5).map(tip => `
                    <div class="flex items-start">
                        <svg class="w-5 h-5 text-green-600 mr-2 mt-0.5 flex-shrink-0" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd"></path>
                        </svg>
                        <span class="text-sm text-gray-700">${tip}</span>
                    </div>
                `).join('');
            }

            async askAI(question) {
                try {
                    // Show loading state
                    const loadingAlert = document.createElement('div');
                    loadingAlert.className = 'fixed top-4 right-4 z-50 bg-blue-500 text-white p-4 rounded-lg shadow-lg';
                    loadingAlert.innerHTML = `
                        <div class="flex items-center">
                            <div class="animate-spin rounded-full h-5 w-5 border-b-2 border-white mr-3"></div>
                            <span>AI is thinking...</span>
                        </div>
                    `;
                    document.body.appendChild(loadingAlert);

                    // Prepare context for AI
                    const context = {
                        symptoms: this.analysisData.symptoms.join(', '),
                        severityLevel: this.analysisData.severityLevel.level,
                        predictions: this.analysisData.predictions.map(p => `${p.disease} (${p.confidence}%)`).join(', '),
                        age: healthcareAI.userProfile.age,
                        gender: healthcareAI.userProfile.gender
                    };

                    // Call Gemini AI
                    const response = await healthcareAI.callGeminiAI(question, context);

                    // Remove loading alert
                    document.body.removeChild(loadingAlert);

                    // Show AI response in a styled modal
                    const modal = document.createElement('div');
                    modal.className = 'fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4';
                    modal.innerHTML = `
                        <div class="bg-white rounded-2xl p-8 max-w-2xl max-h-96 overflow-y-auto shadow-2xl">
                            <div class="flex items-center justify-between mb-4">
                                <h3 class="text-xl font-semibold text-gray-900">🤖 AI Health Assistant</h3>
                                <button class="close-modal text-gray-400 hover:text-gray-600 transition-colors">
                                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                                    </svg>
                                </button>
                            </div>
                            <div class="mb-4 bg-gray-50 rounded-lg p-4">
                                <h4 class="font-medium text-gray-900 mb-2">Your Question:</h4>
                                <p class="text-gray-700">${question}</p>
                            </div>
                            <div class="bg-blue-50 rounded-lg p-4">
                                <h4 class="font-medium text-gray-900 mb-2">AI Response:</h4>
                                <div class="text-gray-700 whitespace-pre-wrap">${response}</div>
                            </div>
                            <div class="mt-6 flex justify-end">
                                <button class="close-modal bg-gradient-to-r from-blue-600 to-green-600 text-white px-6 py-2 rounded-lg hover:from-blue-700 hover:to-green-700 transition-all">
                                    Close
                                </button>
                            </div>
                        </div>
                    `;

                    document.body.appendChild(modal);

                    // Close modal functionality
                    modal.querySelectorAll('.close-modal').forEach(btn => {
                        btn.addEventListener('click', () => {
                            document.body.removeChild(modal);
                        });
                    });

                    modal.addEventListener('click', (e) => {
                        if (e.target === modal) {
                            document.body.removeChild(modal);
                        }
                    });

                } catch (error) {
                    console.error('AI Error:', error);
                    alert('Unable to get AI response. Please try again later.');
                }
            }

            saveResults() {
                const results = {
                    ...this.analysisData,
                    savedAt: new Date().toISOString()
                };
                
                localStorage.setItem('healthAnalysisResults', JSON.stringify(results));
                alert('Results saved successfully!');
            }

            shareResults() {
                const shareText = `Health Analysis Results:\n\nSymptoms: ${this.analysisData.symptoms.join(', ')}\nSeverity: ${this.analysisData.severityLevel.level}\nTop Prediction: ${this.analysisData.predictions[0].disease}\nConfidence: ${this.analysisData.predictions[0].confidence}%`;
                
                if (navigator.share) {
                    navigator.share({
                        title: 'Healthcare Analysis Results',
                        text: shareText
                    });
                } else {
                    navigator.clipboard.writeText(shareText).then(() => {
                        alert('Results copied to clipboard!');
                    });
                }
            }

            getSymptomSeverity(symptom) {
                const severityMap = {
                    'itching': 1, 'skin_rash': 3, 'headache': 3, 'fever': 5, 'cough': 4,
                    'fatigue': 4, 'nausea': 5, 'chest_pain': 7, 'stomach_pain': 5
                };
                return severityMap[symptom] || 3;
            }

            getSeverityColor(severity) {
                if (severity <= 2) return 'bg-green-500';
                if (severity <= 4) return 'bg-yellow-500';
                if (severity <= 6) return 'bg-orange-500';
                return 'bg-red-500';
            }

            formatSymptomName(symptom) {
                return symptom.split('_').map(word => 
                    word.charAt(0).toUpperCase() + word.slice(1)
                ).join(' ');
            }

            getDiseaseDescription(disease) {
                const descriptions = {
                    'Common Cold': 'A viral infection of the upper respiratory tract, typically mild and self-limiting.',
                    'Flu': 'Influenza is a viral infection that attacks your respiratory system, more severe than common cold.',
                    'Bronchial Asthma': 'A chronic inflammatory disease of the airways causing breathing difficulties.',
                    'Fungal infection': 'A common skin condition caused by fungi, characterized by itching and skin changes.',
                    'Allergy': 'An immune system reaction to environmental substances causing respiratory symptoms.',
                    'GERD': 'Gastroesophageal reflux disease causing stomach pain and acidity.',
                    'Migraine': 'Severe headaches often accompanied by nausea and visual disturbances.',
                    'Hypertension': 'High blood pressure that can cause headaches and chest discomfort.',
                    'Diabetes': 'A metabolic disorder affecting blood sugar levels and energy.',
                    'Pneumonia': 'Infection of the lungs causing fever and breathing problems.'
                };
                
                return descriptions[disease] || 'Medical condition requiring professional evaluation.';
            }
        }

        // Initialize results page
        const resultsPage = new ResultsPage();

        // Animate page elements on load
        document.addEventListener('DOMContentLoaded', function() {
            anime({
                targets: '.hover-lift',
                translateY: [30, 0],
                opacity: [0, 1],
                delay: anime.stagger(200),
                duration: 800,
                easing: 'easeOutExpo'
            });
        });
    </script>
</body>
</html>